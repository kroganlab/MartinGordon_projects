"0","runEnrichment <- function(dt, ont, keepCl='MRC5', title, isKEGG=F){"
"0","  "
"0","  sub.dt <-dt"
"0","  "
"0","  # pull out bg"
"0","  universe <-  unique(sub.dt$id)"
"0","  "
"0","  # create enrichment groups"
"0","  sub.dt[, enrich.grp := interaction(contrast, sig)]"
"0","  "
"0","  # run GO enrichment on each group seperately"
"0","  enrich.dt <- enricherOnGroups(sub.dt[sig != 'not'], "
"0","                              groupColumns = 'enrich.grp', "
"0","                              geneColumn = ""id"", "
"0","                              term2gene.gmt = ont, "
"0","                              universe = universe)"
"0","  "
"0","  if (isKEGG) {"
"0","    "
"0","    return(list("
"0","              enrich=enrich.dt))"
"0","    "
"0","  } else {"
"0","    simp.enrich <- simplifyEnrichBySimilarUniverseMembership(enrichResultsTable = enrich.dt, "
"0","                                                           gmt=ont, "
"0","                                                           groupColumn = 'enrich.grp',"
"0","                                                           max_pAdjust = 0.1)"
"0","    "
"0","    return(list("
"0","              enrich=enrich.dt,"
"0","              simpenrich=simp.enrich))"
"0","  }"
"0","}"
